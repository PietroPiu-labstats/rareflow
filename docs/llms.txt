# rareflow: Variational Flow-Based Inference for Rare Events

**Normalizing Flows for Rare-Event Inference**

![License: GPL-3](https://img.shields.io/badge/license-GPL--3-blue.svg)

License: GPL-3

------------------------------------------------------------------------

## Overview

**rareflow** provides a unified framework for rare-event inference by
combining:

- **Sanov theory** for empirical distributions  
- **Girsanov change of measure** for SDEs  
- **Freidlin–Wentzell large deviations** for small-noise diffusions  
- **Normalizing flows** for flexible variational inference

The package includes:

- modular flow models (planar, radial, MAF, spline)  
- variational optimization via ELBO  
- wrappers for Girsanov tilting and FW quasi-potentials  
- tools for rare-event simulation and analysis

------------------------------------------------------------------------

## Installation

### From GitHub

``` r
# install.packages("devtools")
devtools::install_github("PietroPiu-labstats/rareflow")
```

## Quick Example

A minimal workflow for fitting a variational posterior using a planar
flow:

``` r
library(rareflow)

Qobs <- c(0.05, 0.90, 0.05)
px <- function(z) c(0.3, 0.4, 0.3)

flow <- makeflow("planar")
fit <- fitflowvariational(Qobs, pxgivenz = px, nmc = 500)

fit$elbo
```

## Girsanov Tilting

``` r
b <- function(x) -x
dt <- 0.01
T <- 1000
Winc <- rnorm(T, sd = sqrt(dt))

fit_gir <- fitflow_girsanov(
  observed = Qobs,
  drift = b,
  Winc = Winc,
  dt = dt,
  pxgivenz = px
)
```

## Freidlin–Wentzell Quasi-Potential

``` r
b <- function(x) x - x^3
qp <- FW_quasipotential(-1, 1, drift = b, T = 200, dt = 0.01)
qp$action
```

## Documentation

Full documentation and examples are available in the package vignette:

``` r
vignette("rareflow")
```

## Features

- Variational inference with normalizing flows

- Rare-event tilting via Girsanov

- Minimum-action paths and quasi-potentials

- Support for 1D and 2D systems

- Modular flow architecture

# Package index

## Core Methods

- [`Freidlin_Wentzell_action()`](https://pietropiu-labstats.github.io/rareflow/reference/Freidlin_Wentzell_action.md)
  : Freidlin–Wentzell Action Functional
- [`FW_quasipotential()`](https://pietropiu-labstats.github.io/rareflow/reference/FW_quasipotential.md)
  : Freidlin–Wentzell Quasi-Potential via Path Minimization
- [`FW_minimum_action_path()`](https://pietropiu-labstats.github.io/rareflow/reference/FW_minimum_action_path.md)
  : Minimum Action Path (MAP)
- [`girsanov_logratio()`](https://pietropiu-labstats.github.io/rareflow/reference/girsanov_logratio.md)
  : Girsanov Log-Ratio for Drift-Tilted Diffusions
- [`KLdiv()`](https://pietropiu-labstats.github.io/rareflow/reference/KLdiv.md)
  : Kullback–Leibler Divergence
- [`sanovprob()`](https://pietropiu-labstats.github.io/rareflow/reference/sanovprob.md)
  : Sanov Probability Bound

## Flow Models

- [`mafflowmodel()`](https://pietropiu-labstats.github.io/rareflow/reference/mafflowmodel.md)
  : Masked Autoregressive Flow (MAF)
- [`planarflowmodel()`](https://pietropiu-labstats.github.io/rareflow/reference/planarflowmodel.md)
  : Planar Normalizing Flow (1D)
- [`radialflowmodel()`](https://pietropiu-labstats.github.io/rareflow/reference/radialflowmodel.md)
  : Radial Normalizing Flow (1D)
- [`splinepwlinflowmodel()`](https://pietropiu-labstats.github.io/rareflow/reference/splinepwlinflowmodel.md)
  : Piecewise-Linear Spline Flow (Monotone)

## Flow Fitting

- [`fitflowvariational()`](https://pietropiu-labstats.github.io/rareflow/reference/fitflowvariational.md)
  : Fit a Flow-Based Variational Posterior for Sanov Inference
- [`fitflow_FW()`](https://pietropiu-labstats.github.io/rareflow/reference/fitflow_FW.md)
  : Fit Flow Using Freidlin–Wentzell Quasi-Potential
- [`fitflow_girsanov()`](https://pietropiu-labstats.github.io/rareflow/reference/fitflow_girsanov.md)
  : Fit Flow with Girsanov-Tilted Likelihood
- [`ELBOflow()`](https://pietropiu-labstats.github.io/rareflow/reference/ELBOflow.md)
  : Evidence Lower Bound (ELBO) for Flow-Based Variational Inference

## Model Constructors

- [`makeflow()`](https://pietropiu-labstats.github.io/rareflow/reference/makeflow.md)
  : Flow Factory
- [`makebiolik()`](https://pietropiu-labstats.github.io/rareflow/reference/makebiolik.md)
  : Biological Two-Separator Likelihood
- [`makeneurolik()`](https://pietropiu-labstats.github.io/rareflow/reference/makeneurolik.md)
  : Neural Two-Separator Likelihood

# Articles

### Vignettes

- [rareflow: Normalizing Flows for Rare-Event
  Inference](https://pietropiu-labstats.github.io/rareflow/articles/rareflow.md):
- [Cell-fate transitions as rare
  events](https://pietropiu-labstats.github.io/rareflow/articles/rareflow_biology.md):
